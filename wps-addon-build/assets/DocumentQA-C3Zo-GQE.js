import{_ as k,c as u,a as n,t as g,d as m,w as x,v as T,r as v,i as q,j as P,u as S,o as p}from"./index-CelDLeeQ.js";const C={setup(){S();const l=v(""),t=v(""),r=v(!1),e=v(""),w=v(""),d=o=>{console.log("安全警告:",o);try{typeof window.Application.Alert=="function"?window.Application.Alert(o):alert(o)}catch(c){console.error("所有警告方法都失败:",c);try{alert(o)}catch(a){console.error("原生alert也失败:",a)}}};q(async()=>{if(window.Application&&window.Application.ActiveDocument)try{if(window.Application.ActiveDocument.Application&&window.Application.ActiveDocument.Application.Selection){const o=window.Application.ActiveDocument.Application.Selection.Text;o&&o.trim()&&(e.value=o,console.log("已获取选中文本，长度:",e.value.length))}if(!e.value&&window.Application.ActiveDocument.Range){const o=window.Application.ActiveDocument.Range().Text;w.value=o,console.log("已获取整个文档内容，长度:",w.value.length)}}catch(o){console.error("获取文档内容失败:",o)}});const s=async()=>{if(!(!l.value||r.value)){r.value=!0,t.value="";try{const o=e.value||w.value;if(!o){d("无法获取文档内容，请确保文档已打开并且文本可访问"),r.value=!1;return}let c=o;const a=8e3;if(o.length>a){console.warn(`文本内容过长(${o.length}字符)，将进行智能截断`);const i=o.substring(0,a/2),A=o.substring(o.length-a/2);c=`${i}
...(中间内容已省略)...
${A}`,console.log("截断后文本长度:",c.length)}t.value=await P.documentQA(c,l.value),h("qa",l.value,t.value),console.log("问答完成，回答长度:",t.value.length)}catch(o){console.error("处理问答时出错:",o),d("问答失败: "+o.message)}finally{r.value=!1}}},h=(o,c,a)=>{try{if(window.Application&&window.Application.PluginStorage){console.log("保存历史记录:",o);let i=[];const A=window.Application.PluginStorage.getItem("aiHistory");if(A)try{i=JSON.parse(A)}catch(_){console.error("解析历史记录失败:",_),i=[]}const b={type:o,input:c,output:a,timestamp:new Date().getTime()};i.unshift(b),i.length>50&&(i=i.slice(0,50)),window.Application.PluginStorage.setItem("aiHistory",JSON.stringify(i)),console.log("历史记录已保存，当前共",i.length,"条记录")}}catch(i){console.error("保存历史记录失败:",i)}},y=()=>{try{if(!t.value)return;if(window.Application.ActiveDocument){const o=`
问题: ${l.value}
答案: ${t.value}
`;window.Application.ActiveDocument.Application&&window.Application.ActiveDocument.Application.Selection?(window.Application.ActiveDocument.Application.Selection.TypeText(o),d("已将问答结果插入到文档"),f()):d("无法将文本插入到文档")}}catch(o){console.error("插入文本到文档失败:",o),d("插入失败: "+o.message)}},D=()=>{l.value="",t.value=""},f=()=>{window.Application&&window.Application.CloseDialog()};return{question:l,answer:t,isProcessing:r,selectedText:e,handleAsk:s,insertToDocument:y,reset:D,closeDialog:f}}},I={class:"qa-container"},N={class:"qa-header"},R={key:0,class:"qa-info"},B={key:1,class:"qa-info"},H={class:"qa-content"},V={class:"question-section"},E=["disabled"],J=["disabled"],M={key:0,class:"answer-section"},O={class:"answer-content"},Q={class:"actions"},j={key:1,class:"loading"},L={class:"qa-footer"};function U(l,t,r,e,w,d){return p(),u("div",I,[n("div",N,[t[5]||(t[5]=n("h2",null,"文档问答",-1)),e.selectedText?(p(),u("div",R,"已选中"+g(e.selectedText.length)+"个字符",1)):(p(),u("div",B,"未选中文本，将对整个文档进行问答"))]),n("div",H,[n("div",V,[t[6]||(t[6]=n("div",{class:"label"},"请输入您的问题：",-1)),x(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.question=s),class:"question-input",placeholder:"请输入您对文档的问题...",disabled:e.isProcessing},null,8,E),[[T,e.question]]),n("button",{onClick:t[1]||(t[1]=(...s)=>e.handleAsk&&e.handleAsk(...s)),class:"ask-button",disabled:!e.question||e.isProcessing},g(e.isProcessing?"处理中...":"提问"),9,J)]),e.answer?(p(),u("div",M,[t[7]||(t[7]=n("div",{class:"label"},"AI回答：",-1)),n("div",O,g(e.answer),1),n("div",Q,[n("button",{onClick:t[2]||(t[2]=(...s)=>e.insertToDocument&&e.insertToDocument(...s)),class:"action-btn insert-btn"},"插入到文档"),n("button",{onClick:t[3]||(t[3]=(...s)=>e.reset&&e.reset(...s)),class:"action-btn reset-btn"},"重新提问")])])):m("",!0),e.isProcessing?(p(),u("div",j,t[8]||(t[8]=[n("div",{class:"spinner"},null,-1),n("div",null,"正在处理您的问题，请稍候...",-1)]))):m("",!0)]),n("div",L,[n("button",{onClick:t[4]||(t[4]=(...s)=>e.closeDialog&&e.closeDialog(...s)),class:"close-btn"},"关闭")])])}const F=k(C,[["render",U],["__scopeId","data-v-6e7a5c28"]]);export{F as default};
