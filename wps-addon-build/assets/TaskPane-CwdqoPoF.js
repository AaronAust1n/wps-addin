import{_ as K,c as u,a as s,t as v,d as D,F as j,k as J,w as O,v as G,l as X,m as Y,r as d,g as Z,i as $,j as c,p as z,o as m,n as ee}from"./index-CelDLeeQ.js";const ne={setup(){const i=d("准备就绪"),o=d(""),f=d(""),t=d([]),y=d(!1),h=d("全文总结"),a=d(""),w=d(!1),C=d(""),k=d(!1),R=Z(()=>o.value==="qa"?"WPS AI文档问答":o.value==="summary"?"WPS AI文档摘要":"WPS AI助手"),U=()=>{const e=new URL(window.location.href),n=new URLSearchParams(e.search||e.hash.split("?")[1]);return{function:n.get("function"),direct:n.get("direct")==="true",selection:n.get("selection")==="true",refresh:n.get("refresh")}},g=()=>{try{const e=window.Application.ActiveDocument.Range;return e?e.Text:(window.Application.Alert("未选择任何文本"),null)}catch(e){return console.error("获取选中文本失败:",e),window.Application.Alert("获取选中文本失败: "+e.message),null}},T=()=>{try{const e=window.Application.ActiveDocument.Range;return e?e.Paragraphs(1).Range.Text:null}catch(e){return console.error("获取段落失败:",e),null}},I=()=>{try{const e=window.Application.ActiveDocument;return e?e.Range().Text:(window.Application.Alert("无法获取文档内容"),null)}catch(e){return console.error("获取文档内容失败:",e),window.Application.Alert("获取文档内容失败: "+e.message),null}},p=e=>{try{const n=window.Application.ActiveDocument.Range;return n.Collapse(),n.InsertAfter(e),!0}catch(n){return console.error("插入文本失败:",n),window.Application.Alert("插入文本失败: "+n.message),!1}},A=()=>{if(window.Application&&window.Application.PluginStorage){const e=window.Application.PluginStorage.getItem("aiConfig");if(e)try{return JSON.parse(e)}catch(n){console.error("配置加载失败",n)}}return null},b=()=>{const e=A();return!e||!e.apiUrl?(window.Application.Alert("请先配置API设置"),handleSettings(),!1):!0},M=async()=>{if(!b())return;const e=g();if(e)x("continue",e);else{const n=T();if(!n){window.Application.Alert("请先选择文本或将光标放置在段落中");return}S("continue",n)}},H=async()=>{if(!b())return;const e=g();if(e)x("proofread",e);else{const n=T();if(!n){window.Application.Alert("请先选择文本或将光标放置在段落中");return}S("proofread",n)}},B=async()=>{if(!b())return;const e=g();if(e)x("polish",e);else{const n=T();if(!n){window.Application.Alert("请先选择文本或将光标放置在段落中");return}S("polish",n)}},x=async(e,n)=>{i.value="正在处理文本...";try{const r=A();c.updateConfig(r);let l="";switch(e){case"continue":l=await c.continueText(n),p(l),i.value="文本续写完成";break;case"proofread":l=await c.proofreadText(n),p(`
`+l),i.value="文本校对完成，请按Enter确认修改";break;case"polish":l=await c.polishText(n),p(`
`+l),i.value="文本润色完成，请按Enter确认修改";break}}catch(r){i.value="操作失败: "+r.message}},S=async(e,n)=>{i.value="正在处理段落...";try{const r=A();c.updateConfig(r);let l="";switch(e){case"continue":l=await c.continueText(n),p(l),i.value="文本续写完成";break;case"proofread":l=await c.proofreadText(n),p(`
`+l),i.value="文本校对完成，请按Enter确认修改";break;case"polish":l=await c.polishText(n),p(`
`+l),i.value="文本润色完成，请按Enter确认修改";break}}catch(r){i.value="操作失败: "+r.message}},L=()=>{b()&&(o.value="qa",i.value="文档问答已启动")},N=()=>{if(console.log("提交问题按钮被点击"),!f.value.trim()||y.value){console.log("问题为空或正在处理中，忽略提交");return}E()},E=async()=>{if(console.log("执行askQuestion函数"),!f.value.trim()){console.log("问题为空，放弃处理");return}console.log("开始处理问题:",f.value),t.value.push({role:"user",content:f.value});const e=f.value;f.value="",y.value=!0,i.value="正在处理问题...";try{console.log("获取文档内容...");const n=g();console.log(`选中文本状态: ${n?"有选中文本, 长度:"+n.length:"无选中文本"}`);let r;if(n&&n.trim()?(r=n,console.log("使用选中文本进行问答")):(r=I(),console.log("使用全文进行问答, 文本长度:",r?r.length:0)),!r)throw console.error("无法获取文档内容"),new Error("无法获取文档内容");console.log("更新API配置...");const l=A();if(!l)throw console.error("API配置未找到"),new Error("无法获取API配置，请先在设置中配置API");c.updateConfig(l),console.log("发送问答请求到API:",l.apiUrl);const P=await c.documentQA(r,e);if(console.log("问答完成，答案长度:",P?P.length:0),!P)throw console.error("API返回空答案"),new Error("获取到的回答为空");t.value.push({role:"assistant",content:P}),console.log("尝试滚动到对话历史底部"),await z();const _=document.querySelector(".qa-history");_?(console.log("滚动到底部"),_.scrollTop=_.scrollHeight):console.warn("未找到.qa-history元素，无法滚动"),i.value="问题回答完成",console.log("尝试将焦点放回输入框"),await z(),document.querySelector(".qa-input")&&document.querySelector(".qa-input").focus()}catch(n){console.error("文档问答处理失败:",n),t.value.push({role:"assistant",content:"回答失败: "+n.message}),i.value="问答失败: "+n.message}finally{y.value=!1}},V=async()=>{if(!b())return;o.value="summary";const e=g();e&&e.trim()?h.value="选中内容摘要":h.value="全文总结",q()},q=async()=>{w.value=!0,C.value="",a.value="",i.value="正在生成摘要...";try{const e=g(),n=e&&e.trim()?e:I();if(!n)throw new Error("无法获取文档内容");const r=A();c.updateConfig(r),a.value=await c.summarizeDocument(n),i.value="摘要生成完成"}catch(e){console.error("摘要生成失败:",e),C.value="摘要生成失败: "+e.message,i.value="摘要生成失败: "+e.message}finally{w.value=!1}},W=()=>{if(a.value)try{navigator.clipboard.writeText(a.value).then(()=>{i.value="摘要已复制到剪贴板",setTimeout(()=>{i.value="准备就绪"},2e3)}).catch(e=>{console.error("复制到剪贴板失败:",e),i.value="复制失败: "+e.message,Q(a.value)})}catch(e){console.error("复制摘要失败:",e),i.value="复制失败，请手动选择文本复制",Q(a.value)}},Q=e=>{try{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),i.value="摘要已复制到剪贴板",setTimeout(()=>{i.value="准备就绪"},2e3)}catch(n){console.error("备用复制方法失败:",n),i.value="复制失败，请手动选择文本复制"}},F=()=>{k.value&&window.parent&&typeof window.parent.closeTaskPane=="function"?window.parent.closeTaskPane():(o.value="",i.value="准备就绪")};return $(()=>{const e=U();k.value=e.direct||!1,e.function==="qa"?(o.value="qa",i.value="文档问答已启动"):e.function==="summary"&&(o.value="summary",h.value=e.selection?"选中内容摘要":"全文总结",k.value&&q())}),{statusMessage:i,activePanel:o,question:f,qaHistory:t,isProcessing:y,summaryTitle:h,summaryContent:a,isSummarizing:w,summaryError:C,isDirect:k,panelTitle:R,handleContinueText:M,handleProofread:H,handlePolish:B,handleDocumentQA:L,handleSummarizeDoc:V,askQuestion:E,submitQuestion:N,refreshSummary:q,copySummary:W,closePanel:F}}},oe={class:"taskpane-container"},te={class:"taskpane-header"},se={class:"taskpane-content"},ae={key:0,class:"function-panel"},ie={key:1,class:"sidebar-panel"},le={class:"sidebar-header"},re={class:"qa-history",ref:"qaHistoryRef"},ce={class:"qa-role"},ue={class:"qa-content"},de={class:"qa-input-area"},me=["disabled"],ve=["disabled"],fe={key:2,class:"sidebar-panel"},ge={class:"sidebar-header"},pe={class:"summary-content"},ye={key:0,class:"loading-indicator"},he={key:1,class:"error-message"},we={key:2,class:"summary-text"},Ae={key:3,class:"empty-message"},be={class:"sidebar-footer"},ke=["disabled"],Pe=["disabled"],Ce={class:"taskpane-footer"},Te={class:"status-bar"};function xe(i,o,f,t,y,h){return m(),u("div",oe,[s("div",te,[s("h2",null,v(t.panelTitle),1)]),s("div",se,[t.isDirect?D("",!0):(m(),u("div",ae,[s("div",{class:"function-item",onClick:o[0]||(o[0]=(...a)=>t.handleContinueText&&t.handleContinueText(...a))},o[12]||(o[12]=[s("div",{class:"icon"},"📝",-1),s("div",{class:"title"},"文本续写",-1),s("div",{class:"description"},"根据上下文智能续写文档内容",-1)])),s("div",{class:"function-item",onClick:o[1]||(o[1]=(...a)=>t.handleProofread&&t.handleProofread(...a))},o[13]||(o[13]=[s("div",{class:"icon"},"✓",-1),s("div",{class:"title"},"文本校对",-1),s("div",{class:"description"},"检查并修正文档中的错误",-1)])),s("div",{class:"function-item",onClick:o[2]||(o[2]=(...a)=>t.handlePolish&&t.handlePolish(...a))},o[14]||(o[14]=[s("div",{class:"icon"},"✨",-1),s("div",{class:"title"},"文本润色",-1),s("div",{class:"description"},"改进文档表达，使文章更专业",-1)])),s("div",{class:"function-item",onClick:o[3]||(o[3]=(...a)=>t.handleDocumentQA&&t.handleDocumentQA(...a))},o[15]||(o[15]=[s("div",{class:"icon"},"❓",-1),s("div",{class:"title"},"文档问答",-1),s("div",{class:"description"},"基于文档内容回答问题",-1)])),s("div",{class:"function-item",onClick:o[4]||(o[4]=(...a)=>t.handleSummarizeDoc&&t.handleSummarizeDoc(...a))},o[16]||(o[16]=[s("div",{class:"icon"},"📚",-1),s("div",{class:"title"},"全文总结",-1),s("div",{class:"description"},"分析整个文档并生成总结",-1)]))])),t.activePanel==="qa"?(m(),u("div",ie,[s("div",le,[o[17]||(o[17]=s("h3",null,"文档问答",-1)),s("button",{onClick:o[5]||(o[5]=(...a)=>t.closePanel&&t.closePanel(...a)),class:"close-btn"},"×")]),s("div",re,[(m(!0),u(j,null,J(t.qaHistory,(a,w)=>(m(),u("div",{key:w,class:ee(["qa-item",a.role])},[s("div",ce,v(a.role==="user"?"问题":"回答"),1),s("div",ue,v(a.content),1)],2))),128))],512),s("div",de,[O(s("input",{type:"text","onUpdate:modelValue":o[6]||(o[6]=a=>t.question=a),onKeydown:o[7]||(o[7]=X(Y((...a)=>t.submitQuestion&&t.submitQuestion(...a),["prevent"]),["enter"])),placeholder:"请输入问题...",class:"qa-input",disabled:t.isProcessing,ref:"questionInput"},null,40,me),[[G,t.question]]),s("button",{onClick:o[8]||(o[8]=(...a)=>t.submitQuestion&&t.submitQuestion(...a)),class:"qa-submit",disabled:t.isProcessing||!t.question.trim()},v(t.isProcessing?"处理中...":"提问"),9,ve)])])):D("",!0),t.activePanel==="summary"?(m(),u("div",fe,[s("div",ge,[s("h3",null,v(t.summaryTitle),1),s("button",{onClick:o[9]||(o[9]=(...a)=>t.closePanel&&t.closePanel(...a)),class:"close-btn"},"×")]),s("div",pe,[t.isSummarizing?(m(),u("div",ye,o[18]||(o[18]=[s("div",{class:"loading-spinner"},null,-1),s("div",{class:"loading-text"},"正在生成摘要，请稍候...",-1)]))):t.summaryError?(m(),u("div",he,v(t.summaryError),1)):t.summaryContent?(m(),u("div",we,v(t.summaryContent),1)):(m(),u("div",Ae,' 点击"重新生成"按钮开始生成摘要 '))]),s("div",be,[s("button",{onClick:o[10]||(o[10]=(...a)=>t.refreshSummary&&t.refreshSummary(...a)),class:"refresh-btn",disabled:t.isSummarizing},v(t.isSummarizing?"生成中...":"重新生成"),9,ke),s("button",{onClick:o[11]||(o[11]=(...a)=>t.copySummary&&t.copySummary(...a)),class:"copy-btn",disabled:!t.summaryContent}," 复制内容 ",8,Pe)])])):D("",!0)]),s("div",Ce,[s("div",Te,[s("span",null,v(t.statusMessage),1)])])])}const qe=K(ne,[["render",xe],["__scopeId","data-v-06f3c22b"]]);export{qe as default};
