import{_ as R,c as d,a as i,t as _,d as D,r as v,i as N,u as j,j as f,o as p}from"./index-CelDLeeQ.js";const B={setup(){const S=j(),e=v(""),s=v(""),t=v(!1),m=v(""),w=v(""),l=o=>{console.log("安全警告:",o);try{typeof window.Application.Alert=="function"?window.Application.Alert(o):alert(o)}catch(n){console.error("所有警告方法都失败:",n);try{alert(o)}catch(A){console.error("原生alert也失败:",A)}}};N(async()=>{if(window.Application&&window.Application.ActiveDocument)try{if(w.value=S.query.mode||"selection",w.value==="selection"){if(window.Application.ActiveDocument.Application&&window.Application.ActiveDocument.Application.Selection){const o=window.Application.ActiveDocument.Application.Selection.Text;o&&o.trim()&&(e.value=o,console.log("已获取选中文本，长度:",e.value.length),e.value&&g("selection"))}}else w.value==="document"&&window.Application.ActiveDocument.Range&&(m.value=window.Application.ActiveDocument.Range().Text,console.log("已获取整个文档内容，长度:",m.value.length),g("document"))}catch(o){console.error("获取文档内容失败:",o)}});const g=async o=>{if(!t.value){t.value=!0,s.value="";try{let n="";if(o==="selection"?(n=e.value,n||window.Application.ActiveDocument.Application&&window.Application.ActiveDocument.Application.Selection&&(n=window.Application.ActiveDocument.Application.Selection.Text,e.value=n)):(n=m.value,n||window.Application.ActiveDocument.Range&&(n=window.Application.ActiveDocument.Range().Text,m.value=n)),!n){l(`无法获取${o==="selection"?"选中文本":"全文"}，请确保文档已打开并且有可用内容`),t.value=!1;return}let A=n;if(n.length>8e3){console.warn(`文本内容过长(${n.length}字符)，将进行智能截断`);const r=n.split(/\n\s*\n/);if(console.log(`文本分为${r.length}个段落`),r.length>20){const u=[];for(let a=0;a<r.length;a+=5)u.push(r.slice(a,a+5).join(`

`));console.log(`分为${u.length}批进行处理`);const h=[];for(let a=0;a<u.length;a++){console.log(`处理第${a+1}/${u.length}批段落`);const P=u[a];try{const b=await f.summarizeText(P);h.push(b)}catch(b){console.error(`第${a+1}批段落处理失败:`,b),h.push(`[第${a+1}部分处理失败]`)}}const y=h.join(`

`);y.length>2e3?(console.log("生成的摘要仍然较长，进行二次摘要"),s.value=await f.summarizeText(y)):s.value=y}else s.value=await f.summarizeText(n)}else s.value=await f.summarizeText(n);k("summarize",o==="selection"?"选中文本摘要":"全文摘要",s.value),console.log("摘要生成完成，结果长度:",s.value.length)}catch(n){console.error("处理摘要时出错:",n),l("摘要生成失败: "+n.message)}finally{t.value=!1}}},k=(o,n,A)=>{try{if(window.Application&&window.Application.PluginStorage){console.log("保存历史记录:",o);let c=[];const r=window.Application.PluginStorage.getItem("aiHistory");if(r)try{c=JSON.parse(r)}catch(u){console.error("解析历史记录失败:",u),c=[]}const T={type:o,input:n,output:A,timestamp:new Date().getTime()};c.unshift(T),c.length>50&&(c=c.slice(0,50)),window.Application.PluginStorage.setItem("aiHistory",JSON.stringify(c)),console.log("历史记录已保存，当前共",c.length,"条记录")}}catch(c){console.error("保存历史记录失败:",c)}},z=()=>{try{if(!s.value)return;if(window.Application.ActiveDocument){const o=`
【摘要】
${s.value}
`;window.Application.ActiveDocument.Application&&window.Application.ActiveDocument.Application.Selection?(window.Application.ActiveDocument.Application.Selection.TypeText(o),l("已将摘要结果插入到文档"),x()):l("无法将文本插入到文档")}}catch(o){console.error("插入文本到文档失败:",o),l("插入失败: "+o.message)}},C=()=>{s.value=""},x=()=>{window.Application&&window.Application.CloseDialog()};return{sourceText:e,result:s,isProcessing:t,handleSummarize:g,insertToDocument:z,reset:C,closeDialog:x}}},E={class:"summary-container"},H={class:"summary-header"},I={key:0,class:"summary-info"},J={key:1,class:"summary-info"},L={class:"summary-content"},O={key:0,class:"summary-section"},V={class:"button-group"},q=["disabled"],F={key:1,class:"result-section"},G={class:"result-content"},K={class:"actions"},Q={key:2,class:"loading"},U={class:"summary-footer"};function W(S,e,s,t,m,w){return p(),d("div",E,[i("div",H,[e[5]||(e[5]=i("h2",null,"文档摘要",-1)),t.sourceText?(p(),d("div",I,"已处理"+_(t.sourceText.length)+"个字符",1)):(p(),d("div",J,"未能获取文档内容"))]),i("div",L,[!t.isProcessing&&!t.result?(p(),d("div",O,[e[6]||(e[6]=i("div",{class:"label"},"请选择操作：",-1)),i("div",V,[i("button",{onClick:e[0]||(e[0]=l=>t.handleSummarize("selection")),class:"action-btn",disabled:!t.sourceText},"摘要选中内容",8,q),i("button",{onClick:e[1]||(e[1]=l=>t.handleSummarize("document")),class:"action-btn"},"摘要全文")])])):D("",!0),t.result?(p(),d("div",F,[e[7]||(e[7]=i("div",{class:"label"},"摘要结果：",-1)),i("div",G,_(t.result),1),i("div",K,[i("button",{onClick:e[2]||(e[2]=(...l)=>t.insertToDocument&&t.insertToDocument(...l)),class:"action-btn insert-btn"},"插入到文档"),i("button",{onClick:e[3]||(e[3]=(...l)=>t.reset&&t.reset(...l)),class:"action-btn reset-btn"},"重新生成")])])):D("",!0),t.isProcessing?(p(),d("div",Q,e[8]||(e[8]=[i("div",{class:"spinner"},null,-1),i("div",null,"正在生成摘要，请稍候...",-1)]))):D("",!0)]),i("div",U,[i("button",{onClick:e[4]||(e[4]=(...l)=>t.closeDialog&&t.closeDialog(...l)),class:"close-btn"},"关闭")])])}const Y=R(B,[["render",W],["__scopeId","data-v-4b9f90df"]]);export{Y as default};
